(function(h,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(h=typeof globalThis<"u"?globalThis:h||self,e(h.VueWaterfall={},h.Vue))})(this,function(h,e){"use strict";function L(f,t){let l;return function(...p){clearTimeout(l),l=setTimeout(()=>{f.apply(this,p)},t)}}function $(f,t){const l=e.ref(),p=e.ref(0),y=e.ref(new Map),W=e.ref(0),b=e.ref(!1),I=e.ref(new Map);let g=null;const w=e.ref(new Set);let v=null;const{columns:_=3,gap:k=10,minColumnWidth:C=200,hoverEffect:x=!0,fadeInAndOut:M=!1}=t,n=e.ref(C),a=()=>{l.value&&(p.value=l.value?.offsetWidth||0)},o=e.computed(()=>{if(!l.value)return _;const s=Math.floor((p.value+k)/(C+k));return Math.max(Math.min(_,s),1)}),c=e.computed(()=>l.value?(p.value-(o.value-1)*k)/o.value:C),u=async()=>{if(!l.value||f.length===0)return;b.value=!0;const s=new Map,i=new Array(o.value).fill(0);for(let d=0;d<f.length;d++){const r=f[d],m=i.indexOf(Math.min(...i)),T=m*(c.value+k),P=i[m],B=I.value.get(r.id)??await V(r.src,c.value);s.set(r.id,{x:T,y:P,width:c.value,height:B}),i[m]+=B+k}y.value=s,W.value=Math.max(...i),n.value=c.value,b.value=!1},E=L(u,300),O=()=>{g||(g=new ResizeObserver(s=>{for(const i of s){const d=i.target,r=d.dataset.wfId;if(!r)continue;const m=Number.isNaN(Number(r))?r:Number(r);I.value.set(m,d.offsetHeight)}E()}))},N=()=>{v||(v=new IntersectionObserver(s=>{for(const i of s){const r=i.target.dataset.wfId;if(!r)continue;const m=Number.isNaN(Number(r))?r:Number(r);i.isIntersecting?w.value.add(m):w.value.delete(m)}},{root:l.value??null,rootMargin:"0px",threshold:.2}))},R=(s,i)=>{if(!s){I.value.delete(i.id);return}s.dataset.wfId=String(i.id),O(),g.observe(s),I.value.set(i.id,s.offsetHeight),M&&(N(),v.observe(s))},V=(s,i)=>new Promise(d=>{const r=new Image;r.onload=()=>{const m=r.naturalHeight/r.naturalWidth;d(i*m)},r.onerror=()=>{d(200)},r.src=s}),z=()=>{a(),E()};return e.onMounted(()=>{a(),E(),window.addEventListener("resize",z)}),e.onUnmounted(()=>{window.removeEventListener("resize",z),g&&(g.disconnect(),g=null),v&&(v.disconnect(),v=null),I.value.clear(),w.value.clear()}),{containerRef:l,itemPositions:y,containerHeight:W,isLoading:b,hoverEffect:x,calculateLayout:u,renderColumnWidth:n,setItemRef:R,visibleItemIds:w}}const F=["onClick","onMouseenter","onMouseleave"],A=["src","alt"],S=((f,t)=>{const l=f.__vccOpts||f;for(const[p,y]of t)l[p]=y;return l})(e.defineComponent({__name:"WaterfallContainer",props:{items:{},columns:{default:3},gap:{default:10},minColumnWidth:{default:200},hoverEffect:{type:Boolean,default:!0},fadeInAndOut:{type:Boolean,default:!1},hoverFunction:{},clickFunction:{},hoverLeaveFunction:{}},setup(f){const t=f,l=e.ref(!1),{containerRef:p,itemPositions:y,containerHeight:W,calculateLayout:b,setItemRef:I,renderColumnWidth:g,visibleItemIds:w}=$(t.items,{columns:t.columns,gap:t.gap,minColumnWidth:t.minColumnWidth,hoverEffect:t.hoverEffect,fadeInAndOut:t.fadeInAndOut}),v=n=>{const a=t.columns||3,o=t.gap||10,c=n%a,u=Math.floor(n/a),E=`calc((100% - ${o*(a-1)}px) / ${a})`,O=`calc(${c} * (100% / ${a}) + ${c*o}px)`,N=`${u*250+u*o}px`;return{position:"absolute",width:E,left:O,top:N,height:"200px"}},_=n=>{const a=y.value.get(n.id),o=t.hoverEffect?"-3px":"0px",c=t.hoverEffect?"1.01":"1",u={"--hover-translate":o,"--hover-scale":c,width:`${g.value}px`};return a?{...u,position:"absolute",left:`${a.x}px`,top:`${a.y}px`,...t.fadeInAndOut?{}:{opacity:1}}:u},k=n=>{const a=n.target;a.style.opacity="0"};e.watch(y,n=>{n.size>0&&!l.value&&setTimeout(()=>{l.value=!0},100)},{immediate:!0}),e.watch(()=>t.items,(n,a)=>{n.length!==a?.length&&(l.value=!1),b()},{deep:!0});const C=n=>{t.clickFunction&&t.clickFunction(n)},x=n=>{t.hoverFunction&&t.hoverFunction(n)},M=n=>{t.hoverLeaveFunction&&t.hoverLeaveFunction(n)};return(n,a)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"containerRef",ref:p,class:"waterfall-container",style:e.normalizeStyle({height:`${e.unref(W)}px`})},[!l.value&&n.items.length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(n.items,(o,c)=>(e.openBlock(),e.createElementBlock("div",{key:`skeleton-${o.id}`,class:"waterfall-skeleton",style:e.normalizeStyle(v(c))},a[0]||(a[0]=[e.createElementVNode("div",{class:"skeleton-image"},null,-1),e.createElementVNode("div",{class:"skeleton-content"},[e.createElementVNode("div",{class:"skeleton-line skeleton-line-short"}),e.createElementVNode("div",{class:"skeleton-line"})],-1)]),4))),128)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.items,(o,c)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["waterfall-item",{"is-hidden":!l.value,fadeInOut:t.fadeInAndOut,"in-view":e.unref(w).has(o.id)&&t.fadeInAndOut}]),key:o.id,style:e.normalizeStyle(_(o)),ref_for:!0,ref:u=>e.unref(I)(u,o),onClick:u=>C(o),onMouseenter:u=>x(o),onMouseleave:u=>M(o)},[e.renderSlot(n.$slots,"default",{item:o,index:c},()=>[e.createElementVNode("img",{src:o.src,alt:o.alt||"",class:"waterfall-image",loading:"lazy",onError:k},null,40,A)],!0)],46,F))),128))],4))}}),[["__scopeId","data-v-af975b1a"]]),H={install(f){f.component("WaterfallContainer",S)}};h.WaterfallContainer=S,h.default=H,h.useWaterfall=$,Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
